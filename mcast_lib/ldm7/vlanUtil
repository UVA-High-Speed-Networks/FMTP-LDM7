# vlanUtil
#  Created on: Jun 27, 2018
#      Author: Steven R. Emmerson

# Exit on error
set -e

printUsage()
{
    cat 1>&2 <<EOF
Usage:
    $0 create [-n netmask] <interface> <address>
    $0 destroy <interface>
Options:
    -n <netmask>  Netmask. Defaults to usual A, B, or C mask derived from
                  interface IP address (e.g., "-n 255.0.0.0").
Operands:
    <interface>   Specification of virtual interface (e.g., "eth0:1")
    <address>     IP address to assign to the interface (e.g., "10.0.0.1")
EOF
}

create() {
    interface=${1:?Interface not specified}
    address=${2:?Address not specified}
    netmaskOpt=${3:+netmask $3}
    
    ifconfig $interface $netmaskOpt $address
}

destroy() {
    interface=${1:?Interface not specified}
    
    ifconfig $interface down
}

while getopts n: id; do
    case $id in
        n)      netmask="$OPTARG";;
        *)      printUsage
                exit 1;;
    esac
done
shift `expr $OPTIND - 1`

action=${1:?Action not specified}
shift

case $action in
    create)
        create "$@";;
    destroy)
        destroy "$@";;
    *)  printUsage
        exit 1;;
esac
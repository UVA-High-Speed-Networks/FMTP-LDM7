# Deploys LDM7 to all permitted hosts

set -e

deploy()
{
    host=`echo "$@" | awk '{print $NF}'`
    echo "Deploying to $host"
    ./deploy "$@" || echo 1>&2 "Couldn't deploy to $host"
}

cd `dirname $0`

version=`awk '{print $1; exit}' CHANGE_LOG`
ps -fu $USER | grep 'ssh upc'  | grep -v grep >/dev/null && hostSuffix=-r

for i in 0 1 2 3 4 5 6 7; do
    deploy -n $version node0${hostSuffix}
done